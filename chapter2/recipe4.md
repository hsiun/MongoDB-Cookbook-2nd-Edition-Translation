# 从shell更新和删除数据

这也是一个简单的菜谱，在这个菜谱中将探索在测试集合上执行删除和更新操作。我们不会处理我们已经导入的测试数据，因为我们不希望更新或者删除其中的任何数据，作为替代，我们将使用为仅为这个菜谱创建的测试集合。

### 前提条件
我们将为本菜谱创建一个称之为`updAndDelTest`的集合。我们要求服务器已经启动并在运行。参考第一章_单节点MongoDB安装_，_安装和启动服务器_以获取有关如何启动服务器的说明。启动shell并加载`UpdAndDelTest.js`脚本。这个脚本可以从Packt网站下载。连接如何通过启动shell预加载脚本，可以参考第一章，_通过JavaScript在Mongo shell中连接到单个节点_。

### 如何做...
1. 启动MongoDB Shell并预加载脚本：
```
$ mongo --shell updAndDelTest.js
```

2. 当shell启动好，并且甲苯加载好，在shell中执行下面命令：
```
> prepareTestData()
```

3. 如果进行顺利，你将会看到`Inserted 20 documents in updAndDelTest`被打印到控制台：

4. 为了找到对这个集合的感觉，让我们执行下面的查询：
```
> db.updAndDelTest.find({}, {_id:0})
```

5. 我们将会看到对于每个x的值为1和2，它们的y是从1增长到10的。

6. 我们先更新一些文档并观察结果。执行下面更新命令：
```
> db.updAndDelTest.update({x:1}, {$set:{y:0}})
```

7. 执行下面查找命令并观察结果；我们将获得10个文档。注意其中每一个y的值。
```
> db.updAndDelTest.find({x:1}, {_id:0})
```

8. 我们现在执行下面更新：
```
> db.updAndDelTest.update({x:1}, {$set:{y:0}}, {multi:true})
```

9. 再次执行步骤6中给出的查询以查看更新的文档。 它将显示我们前面看到的相同的文档。 再次记下y的值，并将它们与我们上次执行此查询时所看到的结果进行比较，然后再执行步骤7中给出的更新。

10. 现在我们将看到删除是如何实现的了。我们将会再一次选择x为1的文档来测试删除。让我们从集合中删除所有x为1的文档：
```
> db.updAndDelTest.remove({x:1})
```

11. 执行下面的查找命令，并观察结果。我们将不会获得任何结果，这可能是删除操作删除了所有x为1的文档。
```
> db.updAndDelTest.find({x:1}, {_id:0})
```

> 当你在mongo shell中时，且你希望看到函数的源代码，简单的输入不带参数的函数名。例如，在本菜谱中，通过输入函数名`prepareTestdata`，不带参数并回车，我们可以看到我们定义函数的代码。


### 如何生效...
首先，我们设置好我们将会用于更新和删除测试的数据。