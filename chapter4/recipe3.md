# 查看集合状态

也许一个有趣的统计数据来自管理目的，当涉及到存储的使用，集合中文档的数量可能用来估计未来空间，以及基于数据增长的内存需求是获得高水平集合统计的数据。

### 前提条件 ###
为了查找结合状态，我们需要服务器已经启动并运行。一个单节点应该就可以了。请参阅第一章_安装和启动服务器_中的_安装单节点MongoDB_菜谱获取如何启动服务的信息。我们将操作的数据需要被导入到数据库中。导入数据的步骤已经在菜谱_第二章创建测试数据，命令行操作和索引_给出了。一旦这些步骤完成，对于这个菜谱我们都提前完成好了。

### 如何做 ###
1. 我们需要使用`postalCodes`集合来查看状态。

2. 打开mongo shell并连接到正在运行的MongoDB实例。如果你是在默认端口启动mongo的，执行下面命令：
```
$ mongo
```

3. 数据一旦导入，如果索引不存在的话在pincode域创建索引:
```
> db.postalCodes.ensureIndex({'pincode':1})
```

4. 在mongo终端中，执行下面命令：
```
> db.postalCodes.stats()
```

5. 在shell中执行下面命令并观察输出：
```
> db.postalCodes.stats(1024)
```

6. 再观察一次输出。

我们现在将在下一小节看看这些打印出来的值是什么意思。


### 如何实现 ###
如果我们观察这些命令行对的输出，我们看到的所有第二个输出数字的单位是KB，而第一个的则是byte。这个参数提供了一个比例尺，并且所有的数字表示的大小都是被这个比例缩放的。在这里，因为我们给出的值是1024，我们获取所有的值是KB，而如果1024*1024被作为缩放的值传递（展示的尺寸将会是MB）。为了便于分析，我们将使用KB为数字大小的单位。
```
> db.postalCodes.stats(1024)
{
 "ns" : "test.postalCodes",
 "count" : 39732,
 "size" : 9312,
 "avgObjSize" : 240,
 "numExtents" : 6,
 "storageSize" : 10920,
 "lastExtentSize" : 8192,
 "paddingFactor" : 1,
 "paddingFactorNote" : "paddingFactor is unused and unmaintained in
 3.0. It remains hard coded to 1.0 for compatibility only.",
 "userFlags" : 1,
 "capped" : false,
 "nindexes" : 2,
 "totalIndexSize" : 2243,
 "indexSizes" : {
 "_id_" : 1261,
 "pincode_1" : 982
 },
 "ok" : 1
}
```

下面这个 表展示了重要区域的意思：
<!-- 省略了一个表格 -->

文档放在存储设备上是连续分布的。如果文档被更新，结果之一是大小的增加，Mongo将不得不重新存储这个文档。这样操作的结果是这样的更新操作导致了高昂的性能开销。从Mongo 3.0.0开始，两种数据分配策略被使用。一个是_2的幂_，其中文档被分配2的幂的空间（例如，32,64,128等等）。另一种是不追加，在这种方法中集合不期望文档大小被改变。

### 学习更多 ###
在菜谱中，我们学习了如何查询一些集合重要的统计数据。在下一菜谱我们将在数据库级别看看状态。
